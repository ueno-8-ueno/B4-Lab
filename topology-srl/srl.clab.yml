name: srl

topology:
  kinds:
    nokia_srlinux:
      image: ghcr.io/nokia/srlinux
    linux:
      image: praqma/network-multitool:latest
  nodes:
    spine:
        kind: nokia_srlinux
        type: ixrd3l
        exec:
          - sysctl -w net.ipv4.ip_forward=1
          - ip address add dev e1-1 192.168.1.1/24
          - ip address add dev e1-2 192.168.2.1/24
          - ip route add 192.168.11.0/24 via 192.168.1.2 dev e1-1
          - ip route add 192.168.12.0/24 via 192.168.2.2 dev e1-2

    leaf1:
      kind: nokia_srlinux
      type: ixrd2l
      exec:
        - sysctl -w net.ipv4.ip_forward=1
        - ip address add dev e1-1 192.168.1.2/24
        - ip address add dev e1-2 192.168.11.1/24
        - ip route add 192.168.2.0/24 via 192.168.1.1 dev e1-1
        - ip route add 192.168.12.0/24 via 192.168.1.1 dev e1-1
    leaf2:
      kind: nokia_srlinux
      type: ixrd2l
      exec:
        - sysctl -w net.ipv4.ip_forward=1
        - ip address add dev e1-1 192.168.2.2/24
        - ip address add dev e1-2 192.168.12.1/24
        - ip route add 192.168.1.0/24 via 192.168.2.1 dev e1-1
        - ip route add 192.168.11.0/24 via 192.168.2.1 dev e1-1

    pc1:
      kind: linux
      exec:
        - apk add iperf3 # install iperf3
        - ip link set eth1 up
        - ip route del default
        - ip address add dev eth1 192.168.11.10/24
        - ip route add default via 192.168.11.1 dev eth1
    pc2:
      kind: linux
      exec:
        - apk add iperf3 # install iperf3
        - ip link set eth1 up
        - ip route del default
        - ip address add dev eth1 192.168.12.10/24
        - ip route add default via 192.168.12.1 dev eth1

  links:
    - endpoints: ["leaf1:e1-1", "spine:e1-1"]
    - endpoints: ["leaf2:e1-1", "spine:e1-2"]
    - endpoints: ["pc1:eth1", "leaf1:e1-2"]
    - endpoints: ["pc2:eth1", "leaf2:e1-2"]
